"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _loaderUtils = _interopRequireDefault(require("loader-utils"));

var _hashOptions = require("./hashOptions");

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

const extensionMap = {
  jpeg: '.jpg'
};
/**
 * Generate the appropriate extension for a `sharp` format.
 * @param  {String} type `sharp` type.
 * @returns {String} Extension.
 */

const extension = type => {
  var _extensionMap;

  return (_extensionMap = extensionMap[type]) !== null && _extensionMap !== void 0 ? _extensionMap : `.${type}`;
};

const createName = (image, info, params, context, loader) => {
  const template = (typeof params.name === 'string' ? params.name : '[hash].[ext]').replace(/\[([^\]]+)\]/g, (str, name) => {
    if (/^(name|hash)$/.test(name)) {
      return str;
    }

    if (typeof params[name] !== 'undefined') {
      var _params$name;

      return (_params$name = params[name]) === null || _params$name === void 0 ? void 0 : _params$name.toString();
    }

    if (typeof info[name] !== 'undefined') {
      var _info;

      return (_info = info[name]) === null || _info === void 0 ? void 0 : _info.toString();
    }

    return str;
  });
  const resourcePath = loader.resourcePath.replace(/@([0-9]+)x\./, '.').replace(/\.[^.]+$/, extension(info.format));
  const content = Buffer.concat([Buffer.from((0, _hashOptions.hashOptions)(params)), image]);
  return _loaderUtils.default.interpolateName({ ...loader,
    resourcePath
  }, template, {
    content,
    context
  });
};

var _default = createName;
exports.default = _default;
//# sourceMappingURL=createName.js.map